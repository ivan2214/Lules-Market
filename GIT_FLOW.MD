# Gitflow - Flujo de Trabajo Automatizado

Este documento describe el flujo de trabajo GitFlow automatizado del proyecto, dise√±ado para mantener un repositorio limpio, organizado y con producci√≥n estable.

> üöÄ **NUEVO**: Ahora con scripts de automatizaci√≥n y workflows para agilizar tu trabajo.

---

## üìã Tabla de Contenidos

1. [Filosof√≠a del Flujo](#filosof√≠a-del-flujo)
2. [Automatizaci√≥n con Scripts](#automatizaci√≥n-con-scripts)
3. [Workflows Disponibles](#workflows-disponibles)
4. [Flujo Completo Paso a Paso](#flujo-completo-paso-a-paso)
5. [Reglas Importantes](#reglas-importantes)

---

## üéØ Filosof√≠a del Flujo

### Ramas Principales

* **`main`** ‚Üí Producci√≥n, siempre estable
  * ‚ö†Ô∏è **NUNCA se toca directamente en local**
  * Solo se actualiza mediante PRs desde `dev` en GitHub
  * Se sincroniza localmente con `git fetch origin main:main`

* **`dev`** ‚Üí Integraci√≥n y desarrollo
  * Rama base para todo el trabajo
  * Siempre sincronizada con `main` despu√©s de cada merge
  * Aqu√≠ se integran todas las features

* **`feature/*`** o **`fix/*`** ‚Üí Ramas de trabajo
  * Se crean desde `dev`
  * Una rama por funcionalidad o fix
  * Se eliminan despu√©s de mergear

### Flujo Visual

```
feature/nueva-funcionalidad
    ‚Üì (PR con Squash and Merge)
  dev
    ‚Üì (PR con Rebase and Merge)
  main (producci√≥n)
```

---

## ü§ñ Automatizaci√≥n con Scripts

Hemos creado scripts para automatizar las tareas m√°s comunes:

### Para Windows (PowerShell)

```powershell
# Crear nueva feature
.\scripts\git-flow.ps1 new-feature -Name "nombre-de-la-feature"

# Crear nuevo fix
.\scripts\git-flow.ps1 new-fix -Name "nombre-del-fix"

# Sincronizar despu√©s de merge
.\scripts\git-flow.ps1 sync

# Ver estado del repositorio
.\scripts\git-flow.ps1 status
```

### Para Linux/Mac (Bash)

```bash
# Dar permisos de ejecuci√≥n (solo la primera vez)
chmod +x scripts/git-flow.sh

# Crear nueva feature
./scripts/git-flow.sh new-feature nombre-de-la-feature

# Crear nuevo fix
./scripts/git-flow.sh new-fix nombre-del-fix

# Sincronizar despu√©s de merge
./scripts/git-flow.sh sync

# Ver estado del repositorio
./scripts/git-flow.sh status
```

---

## üìù Workflows Disponibles

Los workflows son gu√≠as paso a paso que puedes seguir. Est√°n en `.agent/workflows/`:

### `/new-feature`
Crea una nueva feature branch desde `dev`.

**Uso:**
```bash
# El workflow te guiar√° para crear la rama
# Ejemplo: feature/login-social
```

### `/push-feature`
Sube tu feature branch y te gu√≠a para crear un PR a `dev`.

**Tipo de merge:** Squash and merge ‚úÖ

### `/create-pr-to-main`
Crea un PR de `dev` ‚Üí `main` para desplegar a producci√≥n.

**Tipo de merge:** Rebase and merge ‚úÖ

### `/sync-after-merge`
Sincroniza tu repositorio local despu√©s de mergear un PR.

**Cu√°ndo usar:**
- Despu√©s de mergear feature ‚Üí dev
- Despu√©s de mergear dev ‚Üí main

---

## üîÑ Flujo Completo Paso a Paso

### 1. Iniciar Nueva Feature

**Opci√≥n A: Con script (recomendado)**
```powershell
# Windows
.\scripts\git-flow.ps1 new-feature -Name "login-social"

# Linux/Mac
./scripts/git-flow.sh new-feature login-social
```

**Opci√≥n B: Manual**
```bash
git checkout dev
git pull origin dev
git checkout -b feature/login-social
```

---

### 2. Trabajar en la Feature

```bash
# Hacer cambios en tu c√≥digo
git add .
git commit -m "feat: add social login with Google"

# M√°s cambios...
git add .
git commit -m "feat: add social login with GitHub"
```

---

### 3. Subir Feature y Crear PR

```bash
# Push de la feature
git push -u origin feature/login-social

# Crear PR en GitHub (manual o con GitHub CLI)
gh pr create --base dev --title "feat: Social login" --body "Implementa login con Google y GitHub"
```

**En GitHub:**
1. Ir a la p√°gina del repositorio
2. Crear Pull Request de `feature/login-social` ‚Üí `dev`
3. Revisar cambios
4. Mergear con **"Squash and merge"** ‚úÖ

---

### 4. Sincronizar Despu√©s del Merge

**Opci√≥n A: Con script (recomendado)**
```powershell
# Windows
.\scripts\git-flow.ps1 sync

# Linux/Mac
./scripts/git-flow.sh sync
```

**Opci√≥n B: Manual**
```bash
git checkout dev
git fetch origin
git rebase origin/main
git push origin dev --force
git fetch origin main:main
```

---

### 5. Desplegar a Producci√≥n

Cuando `dev` est√© listo para producci√≥n:

```bash
# Crear PR en GitHub
gh pr create --base main --head dev --title "Release: v1.2.0" --body "## Cambios\n- Feature 1\n- Feature 2"
```

**En GitHub:**
1. Crear Pull Request de `dev` ‚Üí `main`
2. Revisar todos los cambios
3. Mergear con **"Rebase and merge"** ‚úÖ

**Despu√©s del merge:**
```powershell
# Sincronizar todo
.\scripts\git-flow.ps1 sync
```

---

### 6. Limpiar Feature Branches

Despu√©s de sincronizar, elimina las ramas locales mergeadas:

```bash
# Eliminar feature branch local
git branch -d feature/login-social

# Ver ramas locales
git branch
```

---

## ‚ö†Ô∏è Reglas Importantes

### üö´ NUNCA Hacer

1. **NUNCA hacer checkout a `main` localmente**
   ```bash
   # ‚ùå NO HACER ESTO
   git checkout main
   git merge dev
   git push origin main
   ```

2. **NUNCA hacer commits directos en `dev` o `main`**
   - Siempre trabajar en feature/fix branches

3. **NUNCA hacer force push sin confirmar**
   - Solo hacer force push en `dev` despu√©s de sincronizar

### ‚úÖ SIEMPRE Hacer

1. **SIEMPRE partir de `dev` actualizado**
   ```bash
   git checkout dev
   git pull origin dev
   ```

2. **SIEMPRE usar los tipos de merge correctos**
   - Feature ‚Üí Dev: **Squash and merge**
   - Dev ‚Üí Main: **Rebase and merge**

3. **SIEMPRE sincronizar despu√©s de mergear a `main`**
   ```bash
   .\scripts\git-flow.ps1 sync
   ```

4. **SIEMPRE usar nombres descriptivos**
   - ‚úÖ `feature/login-social`
   - ‚úÖ `fix/button-alignment`
   - ‚ùå `feature/test`
   - ‚ùå `fix/bug`

---

## üé® Convenciones de Commits

Seguimos [Conventional Commits](https://www.conventionalcommits.org/):

```bash
feat: nueva funcionalidad
fix: correcci√≥n de bug
docs: cambios en documentaci√≥n
style: cambios de formato (no afectan el c√≥digo)
refactor: refactorizaci√≥n de c√≥digo
test: agregar o modificar tests
chore: tareas de mantenimiento
```

**Ejemplos:**
```bash
git commit -m "feat: add user authentication"
git commit -m "fix: resolve login redirect issue"
git commit -m "docs: update API documentation"
```

---

## üìä Verificar Estado

En cualquier momento puedes verificar el estado:

```powershell
# Con script
.\scripts\git-flow.ps1 status

# Manual
git status
git branch -vv
git log --oneline --graph --all -8
```

---

## üÜò Soluci√≥n de Problemas

### Conflictos durante Rebase

```bash
# 1. Resolver conflictos en los archivos
# 2. Agregar archivos resueltos
git add .

# 3. Continuar rebase
git rebase --continue

# Si quieres cancelar el rebase
git rebase --abort
```

### Olvidaste Sincronizar

```bash
# No hay problema, simplemente ejecuta:
.\scripts\git-flow.ps1 sync
```

### Feature Branch Desactualizada

```bash
git checkout feature/mi-feature
git rebase dev
# Resolver conflictos si hay
git push --force-with-lease
```

---

## üöÄ Resumen R√°pido

```bash
# 1. Nueva feature
.\scripts\git-flow.ps1 new-feature -Name "mi-feature"

# 2. Trabajar y commitear
git add .
git commit -m "feat: descripci√≥n"

# 3. Push y PR
git push -u origin feature/mi-feature
# Crear PR en GitHub: feature ‚Üí dev (Squash and merge)

# 4. Sincronizar
.\scripts\git-flow.ps1 sync

# 5. Cuando dev est√© listo
# Crear PR en GitHub: dev ‚Üí main (Rebase and merge)

# 6. Sincronizar de nuevo
.\scripts\git-flow.ps1 sync
```

---

Este flujo mantiene el proyecto organizado, facilita el trabajo en equipo y asegura una producci√≥n estable. üéâ
